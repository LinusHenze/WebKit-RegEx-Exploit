
.intel_syntax noprefix
.text

.macro putchar chr
    lea rax, [rip+3f]
    mov qword ptr [rip+reentry_function], rax
    movabs rax, 0xFFFF000000000000+\chr
    ret
3:
.endmacro

.globl start
start:
    cmp qword ptr [rip+reentry_function], 0
    je 3f
    mov rax, qword ptr [rip+reentry_function]
    jmp rax
3:
    putchar 72
putchar 101
putchar 108
putchar 108
putchar 111
putchar 32
putchar 119
putchar 111
putchar 114
putchar 108
putchar 100
putchar 32
putchar 102
putchar 114
putchar 111
putchar 109
putchar 32
putchar 65
putchar 115
putchar 115
putchar 101
putchar 109
putchar 98
putchar 108
putchar 121
putchar 33
putchar 10

    // Return value
    movabs rax, 0xFFFF000000000000
    ret

.data

.globl reentry_function
reentry_function:
    .quad 0
