<?php 
  include 'Parsedown.php';
  include 'db.php';

  if (isset(DB::query('SELECT * FROM exoresign WHERE id=:id', array(':id' => $_GET['app']))[0]['name'])) {
    $exo = DB::query('SELECT * FROM exoresign WHERE id=:id', array(':id' => $_GET['app']))[0];
  } else {
    $exo['name'] = "App Not Found";
    $exo['owner'] = "App Not Found";
    $exo['status'] = "App Not Found";
    $exo['version'] = "App Not Found";
    $exo['installLink'] = "App Not Found";
    $exo['description'] = "App Not Found";
  }

?>
<template>
  <div class="page" data-name="app">
    <div class="navbar">
      <div class="navbar-inner sliding">
        <div class="left">
          <a href="#" class="link back">
            <i class="icon icon-back"></i>
            <span class="ios-only">Back</span>
          </a>
        </div>
        <div class="title"><?php echo $exo['name']; ?></div>
        <div class="right">
          <div class="chip" style="font-weight: 500;">
            <div class="chip-media bg-color-blue">
              <img src="img/Revokes.png" width="24px" height="24px" style="border-radius: 50%;">
            </div>
            <div class="chip-label status">Checking</div>
          </div>
        </div>
      </div>
    </div>
    <div class="page-content">
      <div class="list searchbar-found">
        <ul>
          <li class="item-content">
            <div class="item-media">
              <img src="<?php echo $exo['iconURL']; ?>" class="lazy lazy-fade-in" width="60px" height="60px" style="border-radius: 23.37%;">
            </div>
            <div class="item-inner">
              <div class="item-title">
                <div class="item-header"><?php echo $exo['owner']; ?></div>
                <?php echo $exo['name']; ?>
                <div class="item-footer"><?php echo ucfirst($exo['status']); ?></div>
              </div>
              <div class="item-after">
                <?php if ($exo['status'] == "accepted"): ?>
                  <span class="badge" style="width: 80px; height: 30px; line-height: 30px; background: #3E92CC;">
                    <a href="<?php echo $exo['installLink']; ?>" class="link external" style="color: white; font-weight: 600; font-size: 14px;">INSTALL</a>
                  </span>
                  <?php else: ?>
                    <?php if ($exo['status'] == "rejected"): ?>
                        <span class="badge" style="width: 100px; height: 30px; line-height: 30px; background: #3E92CC;">
                          <a href="#" class="link external disabled" style="color: white; font-weight: 600; font-size: 14px;">REJECTED</a>
                        </span>
                      <?php else: ?>
                        <?php if ($exo['status'] == "pending"): ?>
                          <span class="badge" style="width: 100px; height: 30px; line-height: 30px; background: #3E92CC;">
                            <a href="#" class="link external disabled" style="color: white; font-weight: 600; font-size: 14px;">PENDING</a>
                          </span>
                        <?php endif ?>
                    <?php endif ?>
                <?php endif ?>
              </div>
            </div>
          </li>
        </ul>
      </div>
      <div class="block-title">About <?php echo $exo['name']; ?></div>
      <div class="block block-strong">
        <?php 
          $Parsedown = new Parsedown();

          if (empty($exo['mdDescription'])) {
            if (empty($exo['plainDescription'])) {
              if (empty($exo['description'])) {
                echo $Parsedown->text('Description coming soon.');
              } else {
                echo $Parsedown->text($exo['description']);
              }
            } else {
              echo $Parsedown->text($exo['plainDescription']);
            }
          } else {
            echo $Parsedown->text($exo['mdDescription']);
          }
        ?>
      </div>
      <div class="list">
        <ul>
          <li>
            <div class="item-content">
              <div class="item-inner">
                <div class="item-title">Version</div>
                <div class="item-after"><?php echo $exo['version']; ?></div>
              </div>
            </div>
          </li>
          <li>
            <div class="item-content">
              <div class="item-inner">
                <div class="item-title">Owner</div>
                <div class="item-after"><?php echo $exo['owner']; ?></div>
              </div>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </div>
</template>
<script>
  return {
    data: function () {
      var productId = this.$route.params.id;
      var currentProduct;
      this.$root.products.forEach(function (product) {
        if (product.id === productId) {
          currentProduct = product;
        }
      });
      return {
        product: currentProduct,
      };
    }
  };
</script>