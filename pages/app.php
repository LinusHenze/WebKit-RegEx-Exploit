<?php 
  include 'Parsedown.php';
  include 'db.php';

  if (isset(DB::query('SELECT * FROM apps WHERE id=:id', array(':id' => $_GET['app']))[0]['name'])) {
    $app = DB::query('SELECT * FROM apps WHERE id=:id', array(':id' => $_GET['app']))[0];
  } else {
    $app['name'] = "App Not Found";
    $app['author'] = "App Not Found";
    $app['category'] = "App Not Found";
    $app['installMethod'] = "App Not Found";
    $app['mdDescription'] = "App Not Found";
  }

?>
<template>
  <div class="page" data-name="app">
    <div class="navbar">
      <div class="navbar-inner sliding">
        <div class="left">
          <a href="#" class="link back">
            <i class="icon icon-back"></i>
            <span class="ios-only">Back</span>
          </a>
        </div>
        <div class="title"><?php echo $app['name']; ?></div>
        <div class="right">
          <div class="chip" style="font-weight: 500;">
            <div class="chip-media bg-color-blue">
              <img src="img/Revokes.png" width="24px" height="24px" style="border-radius: 50%;">
            </div>
            <div class="chip-label status">Checking</div>
          </div>
        </div>
      </div>
    </div>
    <div class="page-content">
      <div class="list searchbar-found">
        <ul>
          <li class="item-content">
            <div class="item-media">
              <img src="<?php echo $app['iconURL']; ?>" class="lazy lazy-fade-in" width="60px" height="60px" style="border-radius: 23.37%;">
            </div>
            <div class="item-inner">
              <div class="item-title">
                <div class="item-header"><?php echo $app['author']; ?></div>
                <?php echo $app['name']; ?>
                <div class="item-footer"><?php echo ucfirst($app['category']); ?></div>
              </div>
              <div class="item-after">
                <span class="badge" style="width: 80px; height: 30px; line-height: 30px; background: #3E92CC;">
                  <a href="<?php echo $app['installMethod']; ?>" class="link external" style="color: white; font-weight: 600; font-size: 14px;">GET</a>
                </span>
              </div>
            </div>
          </li>
        </ul>
      </div>
      <div class="block-title">About <?php echo $app['name']; ?></div>
      <div class="block block-strong">
        <?php 
          $Parsedown = new Parsedown();

          if (empty($app['mdDescription'])) {
            if (empty($app['plainDescription'])) {
              if (empty($app['description'])) {
                echo $Parsedown->text('Description coming soon.');
              } else {
                echo $Parsedown->text($app['description']);
              }
            } else {
              echo $Parsedown->text($app['plainDescription']);
            }
          } else {
            echo $Parsedown->text($app['mdDescription']);
          }
        ?>
      </div>
      <div class="list">
        <ul>
          <li>
            <div class="item-content">
              <div class="item-inner">
                <div class="item-title">Version</div>
                <div class="item-after"><?php echo $app['version']; ?></div>
              </div>
            </div>
          </li>
          <li>
            <div class="item-content">
              <div class="item-inner">
                <div class="item-title">Developer</div>
                <div class="item-after"><?php echo $app['author']; ?></div>
              </div>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </div>
</template>
<script>
  return {
    data: function () {
      var productId = this.$route.params.id;
      var currentProduct;
      this.$root.products.forEach(function (product) {
        if (product.id === productId) {
          currentProduct = product;
        }
      });
      return {
        product: currentProduct,
      };
    }
  };
</script>